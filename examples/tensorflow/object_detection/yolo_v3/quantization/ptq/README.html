<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prerequisite &mdash; Intel® Neural Compressor  documentation</title><link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../../index.html" class="icon icon-home"> Intel® Neural Compressor
          </a>
              <div class="version">
                1.14.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../README.html">Intel® Neural Compressor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../docs/examples_readme.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../api-documentation/apis.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../docs/doclist.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../docs/releases_info.html">Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../docs/contributions.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../docs/legal_information.html">Legal Information</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/neural-compressor">Intel® Neural Compressor repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">Intel® Neural Compressor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Prerequisite</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../_sources/examples/tensorflow/object_detection/yolo_v3/quantization/ptq/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>This document describes the step-by-step to reproduce Yolo-v3 tuning result with Neural Compressor. This example can run on Intel CPUs and GPUs.</p>
<div class="section" id="prerequisite">
<h1>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>1. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Recommend python 3.6 or higher version.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Intel® Neural Compressor</span>
pip install neural-compressor
</pre></div>
</div>
</div>
<div class="section" id="install-intel-tensorflow">
<h2>2. Install Intel Tensorflow<a class="headerlink" href="#install-intel-tensorflow" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install intel-tensorflow
</pre></div>
</div>
<blockquote>
<div><p>Note: Supported Tensorflow versions please refer to Neural Compressor readme file.</p>
</div></blockquote>
</div>
<div class="section" id="installation-dependency-packages">
<h2>3. Installation Dependency packages<a class="headerlink" href="#installation-dependency-packages" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> examples/tensorflow/object_detection/yolo_v3/quantization/ptq
pip install -r requirements.txt
</pre></div>
</div>
</div>
<div class="section" id="install-intel-extension-for-tensorflow">
<h2>4. Install Intel Extension for Tensorflow<a class="headerlink" href="#install-intel-extension-for-tensorflow" title="Permalink to this headline">¶</a></h2>
<div class="section" id="quantizing-the-model-on-intel-cpu">
<h3>Quantizing the model on Intel CPU<a class="headerlink" href="#quantizing-the-model-on-intel-cpu" title="Permalink to this headline">¶</a></h3>
<p>Intel Extension for Tensorflow is mandatory to be installed for quantizing the model on Intel GPUs.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install --upgrade intel-extension-for-tensorflow<span class="o">[</span>gpu<span class="o">]</span>
</pre></div>
</div>
<p>For any more details, please follow the procedure in <a class="reference external" href="https://github.com/intel-innersource/frameworks.ai.infrastructure.intel-extension-for-tensorflow.intel-extension-for-tensorflow/blob/master/docs/install/install_for_gpu.md#install-gpu-drivers">install-gpu-drivers</a></p>
</div>
<div class="section" id="quantizing-the-model-on-intel-gpu-experimental">
<h3>Quantizing the model on Intel GPU(Experimental)<a class="headerlink" href="#quantizing-the-model-on-intel-gpu-experimental" title="Permalink to this headline">¶</a></h3>
<p>Intel Extension for Tensorflow for Intel CPUs is experimental currently. It’s not mandatory for quantizing the model on Intel CPUs.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install --upgrade intel-extension-for-tensorflow<span class="o">[</span>cpu<span class="o">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="downloaded-yolo-v3-model">
<h2>5. Downloaded Yolo-v3 model<a class="headerlink" href="#downloaded-yolo-v3-model" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/mystic123/tensorflow-yolo-v3.git
<span class="nb">cd</span> tensorflow-yolo-v3
</pre></div>
</div>
</div>
<div class="section" id="download-coco-class-names-file">
<h2>6. Download COCO Class Names File<a class="headerlink" href="#download-coco-class-names-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget https://raw.githubusercontent.com/pjreddie/darknet/master/data/coco.names
</pre></div>
</div>
</div>
<div class="section" id="download-model-weights-full">
<h2>7. Download Model Weights (Full):<a class="headerlink" href="#download-model-weights-full" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>wget https://pjreddie.com/media/files/yolov3.weights
</pre></div>
</div>
</div>
<div class="section" id="generate-pb">
<h2>8. Generate PB:<a class="headerlink" href="#generate-pb" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python convert_weights_pb.py --class_names coco.names --weights_file yolov3.weights --data_format NHWC --size <span class="m">416</span> --output_graph yolov3.pb
</pre></div>
</div>
</div>
<div class="section" id="prepare-dataset">
<h2>9. Prepare Dataset<a class="headerlink" href="#prepare-dataset" title="Permalink to this headline">¶</a></h2>
<div class="section" id="automatic-dataset-download">
<h3>Automatic dataset download<a class="headerlink" href="#automatic-dataset-download" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong><em>Note: <code class="docutils literal notranslate"><span class="pre">prepare_dataset.sh</span></code> script works with TF version 1.x.</em></strong></p>
</div></blockquote>
<p>Run the <code class="docutils literal notranslate"><span class="pre">prepare_dataset.sh</span></code> script located in <code class="docutils literal notranslate"><span class="pre">examples/tensorflow/object_detection/yolo_v3/quantization/ptq</span></code>.</p>
<p>Usage:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> examples/tensorflow/object_detection/yolo_v3/quantization/ptq
. prepare_dataset.sh
</pre></div>
</div>
<p>This script will download the <em>train</em>, <em>validation</em> and <em>test</em> COCO datasets. Furthermore it will convert them to
tensorflow records using the <code class="docutils literal notranslate"><span class="pre">https://github.com/tensorflow/models.git</span></code> dedicated script.</p>
</div>
<div class="section" id="manual-dataset-download">
<h3>Manual dataset download<a class="headerlink" href="#manual-dataset-download" title="Permalink to this headline">¶</a></h3>
<p>Download CoCo Dataset from <a class="reference external" href="https://cocodataset.org/#download">Official Website</a>.</p>
</div>
</div>
</div>
<div class="section" id="get-quantized-yolo-v3-model-with-neural-compressor">
<h1>Get Quantized Yolo-v3 model with Neural Compressor<a class="headerlink" href="#get-quantized-yolo-v3-model-with-neural-compressor" title="Permalink to this headline">¶</a></h1>
<div class="section" id="config-the-yolo-v3-yaml-with-the-valid-cocoraw-data-path-or-the-yolo-v3-itex-yaml-if-using-the-intel-extension-for-tensorflow">
<h2>1.Config the yolo_v3.yaml with the valid cocoraw data path or the yolo_v3_itex.yaml if using the Intel Extension for Tensorflow.<a class="headerlink" href="#config-the-yolo-v3-yaml-with-the-valid-cocoraw-data-path-or-the-yolo-v3-itex-yaml-if-using-the-intel-extension-for-tensorflow" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="config-the-yaml-file">
<h2>2.Config the yaml file<a class="headerlink" href="#config-the-yaml-file" title="Permalink to this headline">¶</a></h2>
<p>In examples directory, there is a yolo_v3.yaml for tuning the model on Intel CPUs. The ‘framework’ in the yaml is set to ‘tensorflow’. If running this example on Intel GPUs, the ‘framework’ should be set to ‘tensorflow_itex’ and the device in yaml file should be set to ‘gpu’. The yolo_v3_itex.yaml is prepared for the GPU case. We could remove most of items and only keep mandatory item for tuning. We also implement a calibration dataloader and have evaluation field for creation of evaluation function at internal neural_compressor.</p>
</div>
<div class="section" id="run-below-command-one-by-one">
<h2>3.Run below command one by one.<a class="headerlink" href="#run-below-command-one-by-one" title="Permalink to this headline">¶</a></h2>
<p>Usage</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> examples/tensorflow/object_detection/yolo_v3/quantization/ptq
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">infer_detections</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">input_graph</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">yolov3_fp32</span><span class="o">.</span><span class="n">pb</span> <span class="o">--</span><span class="n">config</span> <span class="o">./</span><span class="n">yolo_v3</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">output_graph</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">save</span><span class="o">/</span><span class="n">yolov3_tuned3</span><span class="o">.</span><span class="n">pb</span>
</pre></div>
</div>
<p>Finally, the program will generate the quantized Yolo-v3 model with relative 1% loss.</p>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Intel® Neural Compressor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>